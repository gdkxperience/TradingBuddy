// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Calculation {
  id                String   @id @default(cuid())
  userId            String?
  user              User?    @relation(fields: [userId], references: [id])
  
  // Mode
  mode              String   // "forward" | "reverse"
  
  // Forward calculation inputs
  accountSize       Float?
  riskPercentage    Float?
  entryPrice        Float
  stopLossPrice     Float?
  targetPrice       Float?
  tradeType         String   // "long" | "short"
  excessLiquidity   Float?
  
  // Reverse calculation inputs
  availableCash     Float?
  cashUsagePercent  Float?
  
  // Calculated results
  maxLoss           Float?
  riskPerShare      Float?
  maxShares         Float?
  tradeValue        Float?
  initialMarginCost Float?
  rMultiple         Float?
  potentialProfit   Float?
  canAfford         Boolean?
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  @@index([userId])
  @@index([createdAt])
}

model User {
  id                String        @id @default(cuid())
  email             String        @unique
  emailVerified     DateTime?
  name              String?
  password          String?       // Hashed password (null for OAuth users)
  image             String?       // Profile picture URL
  
  // Relations
  accounts          Account[]
  sessions          Session[]
  calculations      Calculation[]
  journalEntries    JournalEntry[]
  settings          UserSettings?
  
  // Metadata
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  
  @@index([email])
}

model Account {
  id                String   @id @default(cuid())
  userId            String
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  type              String   // "credentials" | "oauth"
  provider          String   // "credentials" | "google" | "github"
  providerAccountId String   // OAuth provider user ID
  
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  @@unique([provider, providerAccountId])
  @@index([userId])
}

model Session {
  id                String   @id @default(cuid())
  sessionToken      String   @unique
  userId            String
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  expires           DateTime
  
  @@index([userId])
}

model VerificationToken {
  identifier        String
  token             String   @unique
  expires           DateTime
  
  @@unique([identifier, token])
}

model UserSettings {
  id                        String   @id @default(cuid())
  userId                    String   @unique
  user                      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // User preferences
  accountSize               Float?
  defaultRiskPercentage    Float?   @default(5.0)
  defaultCashUsagePercentage Float? @default(50.0)
  checklistGatekeeperEnabled Boolean @default(true)
  
  // Dashboard preferences
  defaultView              String?  @default("calculator") // "calculator" | "dashboard" | "trading-dashboard"
  
  // Notification preferences (future)
  emailNotifications       Boolean  @default(false)
  
  createdAt                 DateTime @default(now())
  updatedAt                 DateTime @updatedAt
}

model JournalEntry {
  id                String   @id @default(cuid())
  userId            String?
  user              User?    @relation(fields: [userId], references: [id])
  
  // Trade identification
  ticker            String
  setupType         String   // "Breakout" | "Pullback" | "Reversal" | "Gap Fill" | "Trend Following" | "Other"
  direction         String   // "long" | "short"
  status            String   @default("order") // "order" | "open" | "closed"
  
  // Trade details
  entryPrice        Float
  stopLossPrice     Float?
  targetPrice       Float?
  positionSize      Float    // Number of shares
  riskAmount        Float?   // Maximum loss amount
  tradeValue        Float?   // Total trade value
  rMultiple         Float?   // Risk:Reward ratio
  potentialProfit   Float?   // Potential profit if target is hit
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  @@index([userId])
  @@index([status])
  @@index([ticker])
  @@index([createdAt])
}
